<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wc-data-viewer</title>
    <link rel="stylesheet" href="https://lcvriend.github.io/wc-multi-selector/static/prism.css">
    <script type="module" src="https://uu-asc.github.io/csa-werkvoorraad/src/darkmode-toggle.js"></script>
    <style>
        body {
            --background-color: hsl(30, 0%, 97%);
            --hover-color: hsl(30, 0%, 92%);
            background-color: var(--background-color);
            color: hsl(30, 0%, 8%);
            margin-inline: auto;
            margin-bottom: 4rem;
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;

            display: grid;
            grid-template-columns:
                3rem [breakout-start]
                auto [content-start]
                720px
                [content-end] auto
                [breakout-end] 3rem;

            &.dark-theme {
                --background-color: hsl(210, 74%, 17%);
                --hover-color: hsl(210, 54%, 28%);
                background-color: var(--background-color);
                color: hsl(30, 0%, 98%);
            }
        }
        body > * {
            grid-column: content;
        }
        body > .breakout {
            grid-column: breakout;
            display: grid;
            justify-content: center;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: min-content;
            grid-auto-flow: dense;
        }
        fieldset {
            min-width: 0;
        }
        #styling {
            grid-column: 3;
            grid-row: 1 / span 2;
        }
        data-viewer {
            --cursor: pointer;
            margin-block: 1.25em;
        }
        pre {
            white-space: pre-wrap;
        }
        table {
            border-collapse: collapse;
            font-family: monospace;
        }
        table thead th {
            text-align: left;
        }
        table tbody tr {
            border-top: 1px solid currentColor;
        }
        table :where(th, td) {
            padding: .125em .25em;
        }
    </style>
</head>
<body>
<header>
    <h1>Data-Viewer</h1>
    <darkmode-toggle></darkmode-toggle>
</header>
<section id="info">
    <h2>Web component</h2>
    <p><code>&lt;data-viewer&gt;</code> is a web component for displaying structured table data with these key features:</p>
    <ul>
        <li>Vanilla JavaScript with no external dependencies</li>
        <li>Loads JSON data from URLs</li>
        <li>Supports single and multi-level column/row structures</li>
        <li>Data type-based formatting using toLocaleString for numbers and dates</li>
        <li>Allows displaying outer index levels as section headers</li>
        <li>Customizable styling through attributes and CSS properties</li>
    </ul>
    <p>Below you'll find examples demonstrating the component's features and usage.</p>
</section>
<section id="controls">
    <fieldset>
        <legend>Data</legend>
        <div>
            <label for="src">Source
                <select name="src" id="src" autocomplete="off">
                    <option value="data/bedragen_2025.json" selected>default</option>
                    <option value="data/multiindex_df.json">multiindex df</option>
                    <option value="data/simple_df.json">simple df</option>
                </select>
            </label>
        </div>
        <div>
            <label for="type">Type
                <select name="type" id="type">
                    <option value="default" selected>default</option>
                </select>
            </label>
        </div>
    </fieldset>
    <fieldset>
        <legend>Calculate</legend>
        <div>
            <label for="calc-op">
                <select name="calc-op" id="calc-op">
                    <option value="multiply">multiply</option>
                    <option value="divide">divide</option>
                    <option value="add">add</option>
                    <option value="subtract">subtract</option>
                </select>
            </label>
        </div>
        <div>
            <label for="n">n
                <input type="number" size="5" name="n" id="n" autocomplete="off">
            </label>
        </div>
    </fieldset>
    <fieldset>
        <legend>Format</legend>
        <div>
            <label for="notation">Notation
                <select name="notation" id="notation" autocomplete="off">
                    <option value="standard" selected>Standard</option>
                    <option value="compact">Compact</option>
                    <option value="engineering">Engineering</option>
                    <option value="scientific">Scientific</option>
                </select>
            </label>
        </div>
        <div>
            <input type="checkbox" id="as-currency" name="as-currency" autocomplete="off" checked>
            <label for="as-currency">as currency</label>
        </div>
        <div>
            <input type="checkbox" id="sep-thousands" name="sep-thousands" autocomplete="off" checked>
            <label for="sep-thousands">seperator</label>
        </div>
    </fieldset>
    <fieldset>
        <legend>Locale</legend>
        <div>
            <input type="radio" id="locale-nl" name="locale" value="nl-NL" autocomplete="off" checked>
            <label for="locale-nl">Nederlands</label>
        </div>
        <div>
            <input type="radio" id="locale-en" name="locale" value="en-US" autocomplete="off" >
            <label for="locale-en">English</label>
        </div>
    </fieldset>
    <fieldset id="styling">
        <legend>Styling</legend>
        <div>
            <label for="section-levels">section levels
                <input type="number" value="0" min="0" size="1" name="section-levels" id="section-levels" autocomplete="off">
            </label>
        </div>
        <div>
            <input type="checkbox" id="hide-column-borders" name="hide-column-borders" autocomplete="off">
            <label for="hide-column-borders">hide column borders</label>
        </div>
        <div>
            <input type="checkbox" id="hide-row-borders" name="hide-row-borders" autocomplete="off">
            <label for="hide-row-borders">hide row borders</label>
        </div>
        <div>
            <input type="checkbox" id="hide-index-border" name="hide-index-border" autocomplete="off">
            <label for="hide-index-border">hide index border</label>
        </div>
        <div>
            <input type="checkbox" id="hide-thead-border" name="hide-thead-border" autocomplete="off">
            <label for="hide-thead-border">hide thead border</label>
        </div>
        <div>
            <input type="checkbox" id="show-hover" name="show-hover" autocomplete="off">
            <label for="show-hover">show hover</label>
        </div>
        <div>
            <input type="checkbox" id="collapse-columns" name="collapse-columns" autocomplete="off">
            <label for="collapse-columns">collapse columns</label>
        </div>
    </fieldset>
</section>
<h2>Output</h2>
<div class="breakout">
    <data-viewer
        src="data/bedragen_2025.json"
        locale="nl-NL"
        margin-labels="Total;Totaal;Subtotal"
    >
    </data-viewer>
</div>
<h3>Event</h3>
<div id="event-display"><pre><code></code></pre></div>
<h2>HTML</h2>
<pre><code class="language-html">&lt;!-- html --&gt;
&lt;data-viewer src="data/example.json" locale="nl-NL"&gt;&lt;/data-viewer&gt;</code></pre>
<h2>Specifications</h2>
<h3>Attributes</h3>
<table>
    <thead>
        <tr>
            <th>Attribute</th>
            <th>Default</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>src</td>
            <td>-</td>
            <td>URL to load JSON data from</td>
        </tr>
        <tr>
            <td>type</td>
            <td>"default"</td>
            <td>Table builder type to use for rendering</td>
        </tr>
        <tr>
            <td>locale</td>
            <td>"default"</td>
            <td>Locale string for number and date formatting</td>
        </tr>
        <tr>
            <td>na-rep</td>
            <td>"-"</td>
            <td>String to display for null/undefined values</td>
        </tr>
        <tr>
            <td>margin-labels</td>
            <td>[]</td>
            <td>Semicolon-separated list of labels to treat as margin rows/columns</td>
        </tr>
        <tr>
            <td>section-levels</td>
            <td>0</td>
            <td>Number of index levels to convert into section headers</td>
        </tr>
        <tr>
            <td>collapse-columns</td>
            <td>false</td>
            <td>Whether to collapse the column headers into the index header row</td>
        </tr>
        <tr>
            <td>show-hover</td>
            <td>false</td>
            <td>Enables row hover highlighting effect</td>
        </tr>
        <tr>
            <td>hide-column-borders</td>
            <td>false</td>
            <td>Removes vertical borders between data columns</td>
        </tr>
        <tr>
            <td>hide-row-borders</td>
            <td>false</td>
            <td>Removes horizontal borders between data rows</td>
        </tr>
        <tr>
            <td>hide-thead-border</td>
            <td>false</td>
            <td>Removes border below the header section</td>
        </tr>
        <tr>
            <td>hide-index-border</td>
            <td>false</td>
            <td>Removes border between index and data columns</td>
        </tr>
    </tbody>
</table>

<h3>CSS Custom Properties</h3>
<table>
    <thead>
        <tr>
            <th>Property</th>
            <th>Default</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>--hover-color</td>
            <td>#f4f3ee</td>
            <td>Background color for row hover effect</td>
        </tr>
        <tr>
            <td>--cursor</td>
            <td>auto</td>
            <td>Cursor style when hovering over cells</td>
        </tr>
        <tr>
            <td>--border-color</td>
            <td>currentColor</td>
            <td>Color for all table borders</td>
        </tr>
        <tr>
            <td>--axes-width</td>
            <td>2px</td>
            <td>Width of primary borders (header and index)</td>
        </tr>
        <tr>
            <td>--section-spacing-top</td>
            <td>1.25em</td>
            <td>Vertical spacing above section headers</td>
        </tr>
        <tr>
            <td>--section-indent</td>
            <td>1rem</td>
            <td>Indentation size per section level</td>
        </tr>
    </tbody>
</table>

<h3>Events</h3>
<table>
    <thead>
        <tr>
            <th>Event</th>
            <th>Detail</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>data-changed</td>
            <td>Data object</td>
            <td>Fired when the component's data is updated</td>
        </tr>
        <tr>
            <td>cell-click</td>
            <td>{value, source, row, col}</td>
            <td>Fired when a cell is clicked, providing cell information</td>
        </tr>
    </tbody>
</table>

<h3>Data</h3>
<table>
    <thead>
        <tr>
            <th>Field</th>
            <th>Required</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>values</td>
            <td>Yes</td>
            <td>2D Array</td>
            <td>Table data content arranged in rows and columns</td>
        </tr>
        <tr>
            <td rowspan="2">columns</td>
            <td rowspan="2">Yes</td>
            <td>Array</td>
            <td>Column labels (single-level): ["A", "B"]</td>
        </tr>
        <tr>
            <td>Array[]</td>
            <td>Column labels (multi-level): [["A1", "B1"], ["A2", "B2"]]</td>
        </tr>
        <tr>
            <td rowspan="2">index</td>
            <td rowspan="2">Yes</td>
            <td>Array</td>
            <td>Row labels (single-level): ["Row1", "Row2"]</td>
        </tr>
        <tr>
            <td>Array[]</td>
            <td>Row labels (multi-level): [["Group1", "Item1"], ["Group1", "Item2"]]</td>
        </tr>
        <tr>
            <td>columnNames</td>
            <td>No</td>
            <td>Array</td>
            <td>Names for each column level in hierarchical order</td>
        </tr>
        <tr>
            <td>indexNames</td>
            <td>No</td>
            <td>Array</td>
            <td>Names for each index level in hierarchical order</td>
        </tr>
        <tr>
            <td>dtypes</td>
            <td>No</td>
            <td>Array</td>
            <td>Data type per column ("str", "int", "float", "bool", "datetime", "category")</td>
        </tr>
        <tr>
            <td>formatOptions</td>
            <td>No</td>
            <td>Object[]</td>
            <td>Locale formatting options per column (currency, notation, grouping, etc)</td>
        </tr>
    </tbody>
</table>

<h4>Example Single-Level Structure</h4>
<pre><code>{
    "values": [[1, 2], [3, 4]],
    "columns": ["A", "B"],
    "index": ["Row1", "Row2"],
    "columnNames": ["Products"],
    "indexNames": ["Items"],
    "dtypes": ["int", "int"]
}</code></pre>

<h4>Example Multi-Level Structure</h4>
<pre><code>{
    "values": [[1, 2], [3, 4]],
    "columns": [["2023", "Q1"], ["2023", "Q2"]],
    "index": [["Region1", "City1"], ["Region1", "City2"]],
    "columnNames": ["Year", "Quarter"],
    "indexNames": ["Region", "City"],
    "dtypes": ["int", "int"]
}</code></pre>

<a href="https://github.com/lcvriend/wc-simple-table">https://github.com/lcvriend/wc-simple-table</a>
<script src="src/viewer.js" type="module"></script>
<script>
    const dataViewer = document.querySelector("data-viewer")
    const eventDisplay = document.getElementById("event-display")

    function truncateJSONString(JSONString, maxLength = 1500) {
        if (JSONString.length <= maxLength) return JSONString
        return JSONString.slice(0,maxLength) + "[...]"
    }

    function getLocale() {
        return document.querySelector('input[type="radio"]:checked')?.value
    }

    function getCalculation(n) {
        const op = document.getElementById("calc-op").value
        n = parseInt(n)
        console.log(op)
        switch (op) {
            case "multiply":
                return value => value ? value * n : null
            case "divide":
                return value => value ? value / n : null
            case "add":
                return value => value ? value + n : null
            case "subtract":
                return value => value ? value - n : null
        }
    }

    function updateTable(n) {
        const op = getCalculation(n)
        const newValues = dataViewer.data.values.map(row => row.map(op))
        dataViewer.data.values = newValues
    }

    function getFormatOptions() {
        const checkboxAsCurrency = document.querySelector(`input[name="as-currency"]`)
        const checkboxSepThousands = document.querySelector('input[name="sep-thousands"]')
        const notation = document.getElementById("notation")
        const formatOptions = {
            "style": checkboxAsCurrency.checked ? "currency" : "decimal",
            "notation": notation.value,
            "currency": "EUR",
            "useGrouping": checkboxSepThousands.checked,
            "minimumFractionDigits": 2,
            "maximumFractionDigits": 2,
            "trailingZeroDisplay": !checkboxAsCurrency.checked ? "stripIfInteger" : "auto",
        }
        return formatOptions
    }

    function handleFormattingChange() {
        const formatOptions = Array(dataViewer.data.values.length).fill(getFormatOptions())
        dataViewer.data.formatOptions = formatOptions
    }

    function handleStylingChange(event) {
        const attr = event.target.id
        dataViewer.toggleAttribute(attr)
    }

    document.addEventListener("color-scheme-change", event => {
        event.detail.scheme === "dark"
        ? document.body.classList.add("dark-theme")
        : document.body.classList.remove("dark-theme")
    })

    document.getElementById("src").addEventListener("change", event => {
        dataViewer.setAttribute("src" , event.target.value)
    })

    dataViewer.addEventListener("cell-click", event => {
        eventDisplay.querySelector("code").innerText = JSON.stringify(event.detail)
    })

    dataViewer.addEventListener("data-changed", event => {
        const JSONString = JSON.stringify(event.detail._rawData)
        const truncatedContent = truncateJSONString(JSONString)
        eventDisplay.querySelector("code").innerText = truncatedContent
    })

    document.querySelectorAll('input[name="locale"]').forEach(radio => {
        radio.addEventListener("change", () => {
            const locale = getLocale()
            dataViewer.setAttribute("locale", locale)
        })
    })

    document.getElementById("as-currency").addEventListener("change", handleFormattingChange)
    document.getElementById("notation").addEventListener("change", handleFormattingChange)
    document.getElementById("sep-thousands").addEventListener("change", handleFormattingChange)
    document.getElementById("controls").addEventListener("change", event => {
        if (!event.target.matches(`[type="checkbox"]`)) return
        handleStylingChange(event)
    })

    document.getElementById("n").addEventListener("change", event => {
        updateTable(event.target.value)
    })

    document.getElementById("section-levels").addEventListener("change", event => {
        dataViewer.setAttribute("section-levels", event.target.value)
    })
</script>
</body>
</html>
